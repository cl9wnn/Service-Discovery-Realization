# Дизайн-документ: Service Discovery и динамическое управления топологией

## Введение 

**Service Discovery** (механизм обнаружения сервисов) позволяет динамически управлять топологией распределенной системы, упрощая маршрутизацию запросов между сервисами.

Данный документ описывает архитектуру системы Service Discovery, функциональные требования и собственную реализацию на базе **Server-Side Discovery Pattern**.
<br><br>

## Архитектура

Наша система будет состоять из API Gateway (который также частично выполняет роль Load Balancer'а) и отдельного Service Discovery для управления регистрацией сервисов.

### 1. ApiGateway

Функциональные требования:
- Принимает входящие HTTP-запросы от клиентов.
- Запрашивает актуальный список зарегистрированных сервисов у Service Discovery.
- Выбирает подходящий экземпляр сервиса для обработки запроса (например, с использованием алгоритма Round-Robin или липкими сессиями).
- Проксирует запрос к выбранному сервису и передает клиенту его ответ.

Реализация:
- Реализация HTTP-сервера на ASP.NET
- Простая маршрутизация запросов с учетом доступных сервисов.
- Поддержка динамического обновления списка сервисов.

### 2. Service Discovery

Функциональные требования:
- Хранит список активных сервисов в памяти.
- Обеспечивает механизмы регистрации и удаления сервисов.
- Поддерживает механизм heartbeat, позволяющий исключать недоступные сервисы.
- Админ-панель для мониторинга запросов и реплик: отслеживание, куда пошёл запрос, время выполнения, статус реплик и метрики и тд.

Реализация:
- Хранение информации о инстансах в Concurrent Dictionary.
- Сервер на ASP.NET. 
- Фоновый процесс, проверяющий доступность сервисов по тайм-ауту на Hangfire.
- Удаление сервисов, не отправивших heartbeat в течение заданного времени.
